package com.appspot.twitterclicker;

import java.io.IOException;
import java.util.Iterator;

import javax.servlet.http.HttpServlet;
import javax.servlet.http.HttpServletResponse;
import javax.servlet.http.HttpServletRequest;
import javax.servlet.ServletException;

import twitter4j.Status;
import twitter4j.Twitter;
import twitter4j.TwitterException;
import twitter4j.TwitterFactory;
import twitter4j.auth.AccessToken;

@SuppressWarnings("serial")
public class TwitterClickerServlet extends HttpServlet {
	public void doGet(HttpServletRequest req, HttpServletResponse resp)
			throws ServletException, IOException {

		resp.setContentType("text/plain");
		resp.setCharacterEncoding("utf-8");

		final String TWITTER_CONSUMER_KEY = "1McdM72IUDyBYp55EYTbHJrut";
		final String TWITTER_CONSUMER_SECRET = "VdwYw3Vi8uIN7vvvOmIMMI2FmG7erJSGho11pDjYCG6dL2WhdH";

		final String TWITTER_ACCESS_TOKEN = "612465140-UmvCQuXgTDUUfSGz6JvG30JUdaflx539dm007kRe";
		final String TWITTER_ACCESS_TOKEN_SECRET = "v6ir8xVQQlfilJ4h6QhszwD5D9hmIbn7T6SSgQWrIL8Ic";

		// アクセストークンの設定
		AccessToken token = new AccessToken(TWITTER_ACCESS_TOKEN,
				TWITTER_ACCESS_TOKEN_SECRET);

		Twitter twitter = new TwitterFactory().getInstance();
		twitter.setOAuthConsumer(TWITTER_CONSUMER_KEY, TWITTER_CONSUMER_SECRET);
		twitter.setOAuthAccessToken(token);

		try {
			Iterator<Status> itr = twitter.getHomeTimeline().iterator();
			Status status = null;
			while (itr.hasNext()) {
				status = itr.next();
				resp.getWriter().println(status.getUser().getName());	// twitterのユーザ名をWebページに出力
				resp.getWriter().println(status.getText());		// twitterのツイート文をWebページに出力
				resp.getWriter().println();
			}
		} catch (TwitterException e) {
			e.printStackTrace();
		}
	}
}
